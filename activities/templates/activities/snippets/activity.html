{% comment %}
    This snippet represents an individual user activities or activity.
    
    Variables:
    
    activity: activity object
    activity_url: the url for the object's activities
    user_timezone: will display the dates in this timezone if provided.  If not,
        will default to 'UTC' time.  Possible values are 'America/Denver', 
        'America/Chicago', etc.
    show_reference_obj: boolean string whether to show the line about which obj  
        the activity is referencing. This has to be a string because of how 
        variables are passed to the snippet.  Should be 'True' or 'False'. 
        Default is 'False'.
    
{% endcomment %}

{% load collection_tags humanize i18n activity_tags url_tags tz %}

{% spaceless %}
{% with user_timezone=user_timezone|default:'UTC' %}
<li class="item-container activity-container" id="n-{{ activity.id }}">

    <ul class="item activity clearfix">
        
        <li class="avatar">
            <a href="{{ activity.created_user.get_absolute_url }}">
              {% with created_user=activity.created_user %}
                {% include 'activities/snippets/user_thumbnail.html' with user=created_user %}
              {% endwith %}
            </a>
        </li>
        <li class="actions">
            {% if activity.created_user_id == user.id %}
                {% if activity.is_editable %}
                <a href="{{ activity.get_edit_url }}"><i class="{{ ICON_EDIT_CLS }}"></i></a>
                {% endif %}
                <a href="{{ activity.get_delete_url }}"><i class="{{ ICON_DECLINE_CLS }}"></i></a>
            {% endif %}
        </li>
        <li class="name">
            <strong>
                <a href="{{ activity.created_user.get_absolute_url }}">{{ activity.created_user.get_full_name }}</a>
            </strong>
            {% with action_html=activity.get_action_html %}
              {% if action_html %}
                <span class="action-text">{{ action_html|safe }}</span>
              {% endif %}
            {% endwith %}
        </li>
        <li class="date"><a href="{{ activity.get_absolute_url }}">{{ activity.created_dttm|timezone:user_timezone|naturaltime }}</a></li>
        <li class="msg">
          {% if activity.text %}
	          {% if activity.source == 'COMMENT' %}
	            {{ activity.text|linebreaks }}
	          {% else %}
	            {{ activity.text|safe|linebreaks }}
	          {% endif %}
	      {% else %}
	          {{ activity.get_html|safe }}
	      {% endif %}
        </li>
        {% with replies=activity.replies.all %}
        {% if replies or not replies and user.is_authenticated %}
        <li class="replies">
            <ul>
                {% for reply in replies %}
                <li class="reply">
                    <ul>
                        <li class="avatar">
                            <a href="{{ reply.created_user.get_absolute_url }}">
                              {% with created_user=reply.created_user  %} 
                                {% include 'activities/snippets/user_thumbnail.html' with user=created_user %}
                              {% endwith %}
                            </a>
                        </li>
                        <li class="actions">
                            {% if reply.created_user_id == user.id %}
                                <a href="{{ reply.get_edit_url }}"><i class="{{ ICON_EDIT_CLS }}"></i></a>
                                <a href="{{ reply.get_delete_url }}"><i class="{{ ICON_DECLINE_CLS }}"></i></a>
                            {% endif %}
                        </li>
                        <li class="name">
                            <strong>
                                <a href="{{ reply.created_user.get_absolute_url }}">{{ reply.created_user.get_full_name }}</a>
                            </strong>
                            <span class="action-text">{{ reply.created_dttm|timezone:user_timezone|naturaltime }}</a>
                        </li>
                        <li class="msg">{{ reply.text|safe|linebreaks }}</li>
                    </ul>
                </li>
                {% endfor %}
            </ul>
            {% if user.is_authenticated %}
            <div class="my-reply">
                <form class="comment-reply-form" action="{{ activity_url }}" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="next" value="{{ request.path}}" />
                    <input type="hidden" name="pid" value="{{ activity.id }}" />
                    {% include 'activities/snippets/user_thumbnail.html' with user=user %}
                    <div class="comment-holder">
                        <input type="text" name="text" class="form-control" placeholder="Make a comment..." />
                    </div>
                </form>
            </div>
            {% endif %}
        </li>     
        {% endif %}
        {% endwith %}
    </ul>
    
</li>
{% endwith %}
{% endspaceless %}
