{% comment %}
    This snippet represents an individual user activities or activity.
    
    Variables:
    
    activity: activity object
    activity_url: the url for the object's activities
    user_timezone: will display the dates in this timezone if provided.  If not,
        will default to 'UTC' time.  Possible values are 'America/Denver', 
        'America/Chicago', etc.
    show_reference_obj: boolean string whether to show the line about which obj  
        the activity is referencing. This has to be a string because of how 
        variables are passed to the snippet.  Should be 'True' or 'False'. 
        Default is 'False'.
    
{% endcomment %}

{% load collection_tags humanize i18n activity_tags url_tags tz %}

{% spaceless %}
{% with user_timezone=user_timezone|default:'UTC' %}
<li class="item-container activity-container{% if user and user.is_authenticated and user == activity.created_user %} created-by-user{% endif %}" id="n-{{ activity.id }}">

    <ul class="item activity clearfix">
        
        <li class="avatar">
            <a href="{{ activity.created_user.get_absolute_url }}">
              {% with created_user=activity.created_user %}
                {% include 'activities/snippets/user_thumbnail.html' with user=created_user %}
              {% endwith %}
            </a>
        </li>
        <li class="actions">
            {% if activity.created_user_id == user.id %}
                <div class="dropdown">
                    <button class="btn btn-default btn-nostyle dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
                        <span class="fa fa-chevron-down"></span>
			        </button>
			        <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
			            {% if activity.is_editable %}
	                    <li><a href="{{ activity.get_edit_url }}">Edit</a></li>
	                    {% endif %}
	                    <li><a href="{{ activity.get_delete_url }}">Delete</i></a></li>
	                </ul>
			    </div>
            {% endif %}
        </li>
        <li class="name">
            <strong>
                <a href="{{ activity.created_user.get_absolute_url }}">{{ activity.created_user.get_full_name }}</a>
            </strong>
            {% with action_html=activity.get_action_html %}
              {% if action_html %}
                <span class="action-text">{{ action_html|safe }}</span>
              {% endif %}
            {% endwith %}
        </li>
        <li class="date"><a href="{{ activity.get_absolute_url }}">{{ activity.created_dttm|timezone:user_timezone|naturaltime }}</a></li>
        <li class="msg">
            {% render_activity_message activity=activity user=user %}
        </li>
        {% with replies=activity.replies.all %}
        {% if replies or not replies and user.is_authenticated %}
        <li class="replies">
            <ul>
                {% for reply in replies %}
                <li class="reply">
                    <ul>
                        <li class="avatar">
                            <a href="{{ reply.created_user.get_absolute_url }}">
                              {% with created_user=reply.created_user  %} 
                                {% include 'activities/snippets/user_thumbnail.html' with user=created_user %}
                              {% endwith %}
                            </a>
                        </li>
                        <li class="actions">
                            {% if reply.created_user_id == user.id %}
                                <div class="dropdown">
				                    <button class="btn btn-default btn-sm btn-nostyle dropdown-toggle" type="button" id="dropdownMenu1" data-toggle="dropdown" aria-haspopup="true" aria-expanded="true">
				                        <span class="fa fa-chevron-down"></span>
				                    </button>
				                    <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
				                        <li><a href="{{ reply.get_edit_url }}">Edit</a></li>
				                        <li><a href="{{ reply.get_delete_url }}">Delete</a></li>
				                    </ul>
				                </div>
                            {% endif %}
                        </li>
                        <li class="name">
                            <strong>
                                <a href="{{ reply.created_user.get_absolute_url }}">{{ reply.created_user.get_full_name }}</a>
                            </strong>
                            <span class="action-text">{{ reply.created_dttm|timezone:user_timezone|naturaltime }}</a>
                        </li>
                        <li class="msg">{{ reply.text|safe|linebreaks }}</li>
                    </ul>
                </li>
                {% endfor %}
            </ul>
            {% if user.is_authenticated %}
            <div class="my-reply">
                <form class="comment-reply-form" action="{{ activity_url }}" method="post">
                    {% csrf_token %}
                    <input type="hidden" name="next" value="{{ request.path}}" />
                    <input type="hidden" name="pid" value="{{ activity.id }}" />
                    {% include 'activities/snippets/user_thumbnail.html' with user=user %}
                    <div class="comment-holder input-group">
                        <input type="text" name="text" class="form-control" placeholder="Make a comment..." />
                        <span class="input-group-btn">
                            <button type="submit" class="btn btn-default btn-xs">Post</button>
                        </span>
                    </div>
                </form>
            </div>
            {% endif %}
        </li>     
        {% endif %}
        {% endwith %}
    </ul>
    
</li>
{% endwith %}
{% endspaceless %}
